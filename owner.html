<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Niyalo Â· Owner Suite</title>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&family=Playfair+Display:ital,wght@0,400;0,500;0,600;0,700;1,600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    /* ----- ALL YOUR EXISTING STYLES - KEEP THEM EXACTLY THE SAME ----- */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      background: #12100e;
      background-image: radial-gradient(circle at 15% 30%, #2a2420 0%, #12100e 95%);
      font-family: 'Plus Jakarta Sans', sans-serif;
      padding: 1.5rem;
      display: flex;
      justify-content: center;
    }
    .owner-container {
      max-width: 1400px;
      width: 100%;
    }
    
    .owner-header {
      background: rgba(28, 24, 22, 0.95);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(196, 154, 108, 0.3);
      border-radius: 60px 60px 30px 30px;
      padding: 1rem 1.8rem;
      margin-bottom: 1.8rem;
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
      border-bottom: 5px solid #c49a6c;
    }
    .logo-area {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .logo-icon {
      background: #c49a6c;
      width: 48px;
      height: 48px;
      border-radius: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.6rem;
      color: #12100e;
    }
    .logo-text h1 {
      font-family: 'Playfair Display', serif;
      font-size: 1.6rem;
      font-weight: 700;
      color: #fcede5;
    }
    .logo-text span {
      font-size: 0.65rem;
      color: #c9ad93;
      letter-spacing: 2px;
      text-transform: uppercase;
    }
    
    .edit-controls {
      display: flex;
      gap: 0.8rem;
      align-items: center;
      flex-wrap: wrap;
    }
    .edit-mode-btn {
      background: #2d5a4b;
      color: white;
      border: 1px solid #6b9b87;
      padding: 0.6rem 1.5rem;
      border-radius: 60px;
      font-size: 0.9rem;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
    }
    .edit-mode-btn.active {
      background: #c49a6c;
      border-color: #e0b692;
    }
    .save-btn {
      background: #27ae60;
      color: white;
      border: none;
      padding: 0.6rem 1.8rem;
      border-radius: 60px;
      font-size: 0.9rem;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
    }
    .guest-link {
      background: #5f4a3d;
      color: white;
      padding: 0.6rem 1.5rem;
      border-radius: 60px;
      text-decoration: none;
      font-size: 0.9rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    [contenteditable="true"] {
      outline: none;
      border-bottom: 2px dashed #b18067;
      background: rgba(255, 235, 220, 0.3);
      cursor: text;
      min-width: 1.5rem;
      display: inline-block;
      padding: 0 4px;
      border-radius: 6px 6px 2px 2px;
      color: #2d241f;
    }
    
    .editing-disabled [contenteditable="true"] {
      border-bottom: none !important;
      background: transparent !important;
      cursor: default !important;
      pointer-events: none !important;
      user-select: none !important;
    }
    
    .editing-disabled .delete-btn,
    .editing-disabled .delete-cat-btn,
    .editing-disabled .add-item-btn,
    .editing-disabled .add-category-btn,
    .editing-disabled .add-badge-btn,
    .editing-disabled .add-footer-btn {
      display: none !important;
    }
    
    .menu-master {
      background: #fcf7f2;
      border-radius: 48px 48px 36px 36px;
      padding: 1.8rem;
      box-shadow: 0 30px 50px -20px black;
      border: 1px solid rgba(229, 179, 144, 0.5);
      margin-bottom: 1.8rem;
    }
    
    .hotel-profile {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
      border-bottom: 3px dashed #d4b19b;
      padding-bottom: 1.5rem;
    }
    .hotel-title {
      font-family: 'Playfair Display', serif;
      font-size: 2.2rem;
      font-weight: 700;
      color: #2b1e19;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .hotel-title i {
      color: #a57159;
      font-size: 2rem;
    }
    .contact-bubble {
      background: #fff1e9;
      padding: 0.7rem 1.5rem;
      border-radius: 60px;
      display: flex;
      flex-wrap: wrap;
      gap: 1.2rem;
    }
    
    .category-card {
      background: white;
      border-radius: 36px;
      padding: 1.5rem;
      margin-bottom: 1.8rem;
      border: 1px solid #efdbd1;
    }
    .category-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 2px dotted #eacbbe;
      padding-bottom: 0.8rem;
      margin-bottom: 1rem;
    }
    .category-title {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .category-title i {
      font-size: 1.8rem;
      color: #aa7862;
    }
    .category-title h3 {
      font-family: 'Playfair Display', serif;
      font-size: 1.6rem;
      font-weight: 600;
      color: #3d2c24;
    }
    .delete-cat-btn {
      background: #c0392b;
      color: white;
      border: none;
      border-radius: 40px;
      padding: 0.3rem 1.2rem;
      font-size: 0.8rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
    }
    
    .menu-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.7rem 0;
      border-bottom: 1px dashed #efd9d0;
    }
    .item-name {
      font-weight: 700;
      font-size: 1.1rem;
      color: #2c1e19;
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
    }
    .item-desc {
      font-size: 0.8rem;
      color: #6b5246;
    }
    .price-tag {
      font-weight: 800;
      font-size: 1.2rem;
      background: #ffefe7;
      padding: 0.2rem 1.2rem;
      border-radius: 60px;
      color: #5c3d33;
    }
    .price-tag span:before {
      content: "à¤°à¥‚";
      margin-right: 4px;
    }
    .delete-btn {
      background: #c0392b;
      color: white;
      border: none;
      border-radius: 50%;
      width: 30px;
      height: 30px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      margin-left: 8px;
    }
    .add-item-btn, .add-category-btn, .add-badge-btn, .add-footer-btn {
      background: #2c5f4b;
      color: white;
      border: none;
      border-radius: 60px;
      padding: 0.5rem 1.5rem;
      font-size: 0.85rem;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      margin-top: 0.8rem;
    }
    .add-category-btn {
      background: #8e6b4f;
    }
    .add-footer-btn {
      background: #8f6e5a;
    }
    
    .footer-editor {
      background: #fdf1ea;
      border-radius: 60px;
      padding: 1.5rem;
      margin-top: 1.8rem;
    }
    .footer-badge-container {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 1rem;
      margin-bottom: 1rem;
    }
    .footer-badge {
      background: #e7d2c5;
      border-radius: 60px;
      padding: 0.3rem 1.2rem;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }
    
    .sync-status {
      display: flex;
      justify-content: flex-end;
    }
    .sync-pulse {
      background: #2d5a4b;
      color: white;
      padding: 0.6rem 1.8rem;
      border-radius: 60px;
      display: inline-flex;
      align-items: center;
      gap: 10px;
      font-size: 0.9rem;
    }
  </style>
</head>
<body>
  <div class="owner-container">
    <div class="owner-header">
      <div class="logo-area">
        <div class="logo-icon">
          <i class="fas fa-crown"></i>
        </div>
        <div class="logo-text">
          <h1>Niyalo Â· Owner</h1>
          <span><i class="fas fa-shield-alt"></i> RESTAURANT CONTROL</span>
        </div>
      </div>
      <div class="edit-controls">
        <button id="editModeBtn" class="edit-mode-btn active">
          <i class="fas fa-lock-open"></i> EDIT ON
        </button>
        <button id="saveBtn" class="save-btn">
          <i class="fas fa-cloud-upload-alt"></i> SAVE
        </button>
        <a href="index.html" target="_blank" class="guest-link">
          <i class="fas fa-eye"></i> VIEW
        </a>
      </div>
    </div>

    <div class="menu-master" id="masterMenu">
      <div class="hotel-profile">
        <div>
          <div class="hotel-title">
            <i class="fas fa-leaf"></i>
            <span contenteditable="true" id="hotelName" spellcheck="false">Niyalo Cafe</span>
            <i class="fas fa-mug-hot"></i>
          </div>
          <div style="display:flex;gap:8px;color:#5f4a3d;margin-top:6px;">
            <i class="fas fa-map-pin"></i>
            <span contenteditable="true" id="hotelLocation" spellcheck="false">Lakeside, Pokhara</span>
            <span>â€¢</span>
            <i class="fas fa-seedling"></i>
            <span contenteditable="true" id="hotelTagline" spellcheck="false">homemade Â· local love</span>
          </div>
        </div>
        <div class="contact-bubble">
          <span><i class="fas fa-clock"></i> <span contenteditable="true" id="hours" spellcheck="false">7:00â€“22:00 daily</span></span>
          <span><i class="fas fa-phone-alt"></i> <span contenteditable="true" id="phone" spellcheck="false">+977 981-234567</span></span>
        </div>
      </div>

      <div id="categoriesContainer"></div>

      <div style="text-align:center;">
        <button class="add-category-btn" id="addCategoryBtn">
          <i class="fas fa-plus-circle"></i> ADD NEW CATEGORY
        </button>
      </div>

      <div class="footer-editor">
        <div style="text-align:center;margin-bottom:1rem;">
          <span style="background:#ab8c7a;color:white;padding:0.3rem 1.5rem;border-radius:60px;font-weight:600;">
            <i class="fas fa-heart"></i> FOOTER BADGES
          </span>
        </div>
        <div class="footer-badge-container" id="footerBadgesContainer"></div>
        <div style="text-align:center;margin-top:0.8rem;">
          <button class="add-footer-btn" id="addFooterBtn">
            <i class="fas fa-plus"></i> ADD BADGE
          </button>
        </div>
        <div style="text-align:center;margin-top:1.5rem;">
          <i class="fas fa-heart" style="color:#c2714b;"></i>
          <span contenteditable="true" id="heartNote" spellcheck="false" style="font-size:1rem;">order at counter Â· everything made to share</span>
          <i class="fas fa-heart" style="color:#c2714b;"></i>
        </div>
      </div>
    </div>

    <div class="sync-status">
      <div class="sync-pulse" id="syncStatus">
        <i class="fas fa-check-circle"></i> READY
      </div>
    </div>
  </div>

  <script>
    // ===========================================
    // NIYALO Â· OWNER SUITE - COMPLETE FIX
    // OWNER MENU NEVER RESETS - USES SAME DATA AS GUEST
    // ===========================================
    
    // ---------- DEFAULT MENU (BACKUP ONLY) ----------
    const DEFAULT_MENU = {
      hotel: {
        name: "Niyalo Cafe",
        location: "Lakeside, Pokhara",
        tagline: "homemade Â· local love",
        hours: "7:00â€“22:00 daily",
        phone: "+977 981-234567",
        address: "Lakeside Rd, Pokhara",
        heartNote: "order at counter Â· everything made to share"
      },
      footer: [
        { id: "footer1", text: "house-baked daily" },
        { id: "footer2", text: "vegan & gluten-free" },
        { id: "footer3", text: "free high-speed wifi" }
      ],
      categories: [
        { id: "cat1", title: "all-day breakfast", icon: "sunrise", items: [
          { id: "item1_1", name: "Niyalo Shakshuka", desc: "poached eggs Â· spiced tomato Â· feta", price: "590", badge: null },
          { id: "item1_2", name: "Cardamom French Toast", desc: "brioche Â· orange Â· maple", price: "520", badge: null },
          { id: "item1_3", name: "Avocado Garden Toast", desc: "sourdough Â· za'atar Â· radish", price: "580", badge: "vegan" },
          { id: "item1_4", name: "House Granola Pot", desc: "yoghurt Â· berries Â· honey", price: "420", badge: null }
        ]},
        { id: "cat2", title: "small plates", icon: "utensils", items: [
          { id: "item2_1", name: "Burnt Eggplant Dip", desc: "smoked paprika Â· flatbread", price: "450", badge: null },
          { id: "item2_2", name: "Chili Garlic Prawns", desc: "lemon Â· parsley Â· sourdough", price: "690", badge: null },
          { id: "item2_3", name: "Wild Mushroom Toast", desc: "thyme Â· truffle oil Â· pecorino", price: "620", badge: "signature" },
          { id: "item2_4", name: "Harissa Cauliflower", desc: "tahini Â· pomegranate Â· almonds", price: "510", badge: null }
        ]},
        { id: "cat3", title: "bowls & greens", icon: "leaf", items: [
          { id: "item3_1", name: "Niyalo Harvest Bowl", desc: "quinoa Â· sweet potato Â· kale Â· miso", price: "650", badge: null },
          { id: "item3_2", name: "Sesame Salmon", desc: "soba Â· edamame Â· pickled ginger", price: "820", badge: null },
          { id: "item3_3", name: "Turmeric Coconut Lentils", desc: "brown rice Â· crispy shallots", price: "550", badge: "vegan" }
        ]},
        { id: "cat4", title: "slow sips", icon: "mug-saucer", items: [
          { id: "item4_1", name: "House Espresso Blend", desc: "single origin Â· honey process", price: "210", badge: null },
          { id: "item4_2", name: "Cardamom Rose Latte", desc: "oat milk Â· dried rose petals", price: "290", badge: "best seller" },
          { id: "item4_3", name: "Iced Turmeric Tonic", desc: "ginger Â· lemon Â· agave", price: "250", badge: null },
          { id: "item4_4", name: "Salted Honey Affogato", desc: "gelato Â· espresso Â· maldon", price: "360", badge: null }
        ]},
        { id: "cat5", title: "sweet corner", icon: "cake", items: [
          { id: "item5_1", name: "Miso Chocolate Chip Cookie", desc: "brown butter Â· sea salt", price: "180", badge: null },
          { id: "item5_2", name: "Pistachio & Orange Cake", desc: "labneh frosting Â· rose", price: "320", badge: null },
          { id: "item5_3", name: "Vegan Berry Crumble", desc: "oat topping Â· coconut cream", price: "340", badge: null },
          { id: "item5_4", name: "Chai-Spiced Bun", desc: "cream cheese drizzle", price: "220", badge: null }
        ]},
        { id: "cat6", title: "cold + curated", icon: "wine-bottle", items: [
          { id: "item6_1", name: "Kombucha (rotating)", desc: "ginger Â· lemongrass Â· local", price: "250", badge: null },
          { id: "item6_2", name: "Orange & Carrot", desc: "cold pressed Â· turmeric", price: "290", badge: null },
          { id: "item6_3", name: "Michelada", desc: "lime Â· tajin Â· agave", price: "390", badge: null },
          { id: "item6_4", name: "Hibiscus Spritz", desc: "sparkling Â· mint Â· lime", price: "350", badge: null }
        ]}
      ]
    };

    // ========== ðŸš€ CRITICAL FIX: LOAD FROM STORAGE AND UPDATE DOM ==========
    let menuData;
    let isEditMode = true;
    
    // Generate ID function
    function generateId(prefix) {
      return prefix + '_' + Date.now() + '_' + Math.floor(Math.random() * 1000);
    }

    // Load saved data or use default
    function loadSavedData() {
      const saved = localStorage.getItem('niyalo_live_menu');
      if (saved) {
        try {
          menuData = JSON.parse(saved);
          console.log('âœ… Loaded SAVED menu data for OWNER');
        } catch(e) {
          console.log('Error parsing, using default');
          menuData = JSON.parse(JSON.stringify(DEFAULT_MENU));
        }
      } else {
        console.log('No saved data, using default');
        menuData = JSON.parse(JSON.stringify(DEFAULT_MENU));
        localStorage.setItem('niyalo_live_menu', JSON.stringify(menuData));
      }
      return menuData;
    }

    // ========== UPDATE DOM WITH SAVED DATA ==========
    function updateDOMWithSavedData() {
      // Update hotel fields
      const hotelName = document.getElementById('hotelName');
      if (hotelName) hotelName.innerText = menuData.hotel.name;
      
      const hotelLocation = document.getElementById('hotelLocation');
      if (hotelLocation) hotelLocation.innerText = menuData.hotel.location;
      
      const hotelTagline = document.getElementById('hotelTagline');
      if (hotelTagline) hotelTagline.innerText = menuData.hotel.tagline;
      
      const hours = document.getElementById('hours');
      if (hours) hours.innerText = menuData.hotel.hours;
      
      const phone = document.getElementById('phone');
      if (phone) phone.innerText = menuData.hotel.phone;
      
      const address = document.getElementById('address');
      if (address) address.innerText = menuData.hotel.address;
      
      const heartNote = document.getElementById('heartNote');
      if (heartNote) heartNote.innerText = menuData.hotel.heartNote;
    }

    // ---------- SAVE TO LOCALSTORAGE (WITH FORCE) ----------
    function saveToLocalStorage(showAlert = true) {
      // Update hotel data from DOM
      menuData.hotel.name = document.getElementById('hotelName')?.innerText || menuData.hotel.name;
      menuData.hotel.location = document.getElementById('hotelLocation')?.innerText || menuData.hotel.location;
      menuData.hotel.tagline = document.getElementById('hotelTagline')?.innerText || menuData.hotel.tagline;
      menuData.hotel.hours = document.getElementById('hours')?.innerText || menuData.hotel.hours;
      menuData.hotel.phone = document.getElementById('phone')?.innerText || menuData.hotel.phone;
      menuData.hotel.address = document.getElementById('address')?.innerText || menuData.hotel.address;
      menuData.hotel.heartNote = document.getElementById('heartNote')?.innerText || menuData.hotel.heartNote;
      
      // Update footer from DOM
      menuData.footer.forEach(f => {
        const el = document.getElementById(f.id);
        if (el) f.text = el.innerText;
      });
      
      // Update items from DOM
      menuData.categories.forEach(cat => {
        cat.items.forEach(item => {
          const n = document.getElementById(item.id);
          if (n) item.name = n.innerText;
          const d = document.getElementById(item.id + 'Desc');
          if (d) item.desc = d.innerText;
          const p = document.getElementById(item.id + 'Price');
          if (p) item.price = p.innerText;
          const b = document.getElementById(item.id + 'Badge');
          if (b && item.badge) item.badge = b.innerText;
        });
        const t = document.getElementById(cat.id + 'Title');
        if (t) cat.title = t.innerText;
      });
      
      // Save to localStorage
      localStorage.setItem('niyalo_live_menu', JSON.stringify(menuData));
      
      // Force second write for mobile
      setTimeout(() => {
        localStorage.setItem('niyalo_live_menu', JSON.stringify(menuData));
      }, 50);
      
      // Create timestamp to trigger mobile storage event
      localStorage.setItem('niyalo_last_update', Date.now().toString());
      
      // Update sync status
      const status = document.getElementById('syncStatus');
      if (status) {
        status.innerHTML = '<i class="fas fa-check-circle"></i> SAVED ' + new Date().toLocaleTimeString();
        status.style.background = '#27ae60';
        setTimeout(() => {
          status.style.background = '#2d5a4b';
          status.innerHTML = '<i class="fas fa-check-circle"></i> READY';
        }, 3000);
      }
      
      if (showAlert) alert('âœ… Menu saved! Changes are permanent.');
      console.log('ðŸ’¾ Saved to localStorage');
    }

    // ---------- RENDER MENU ----------
    function renderOwnerMenu() {
      const container = document.getElementById('categoriesContainer');
      if (!container) return;
      
      container.innerHTML = '';
      
      menuData.categories.forEach(cat => {
        const card = document.createElement('div');
        card.className = 'category-card';
        
        // Header
        const header = document.createElement('div');
        header.className = 'category-header';
        header.innerHTML = `
          <div class="category-title">
            <i class="fas fa-${cat.icon}"></i>
            <h3><span contenteditable="true" id="${cat.id}Title">${cat.title}</span></h3>
          </div>
          <button class="delete-cat-btn" onclick="deleteCategory('${cat.id}')">
            <i class="fas fa-trash-alt"></i> DELETE
          </button>
        `;
        card.appendChild(header);
        
        // Items
        cat.items.forEach(item => {
          const row = document.createElement('div');
          row.className = 'menu-row';
          
          const left = document.createElement('div');
          left.style.flex = '1';
          
          const nameDiv = document.createElement('div');
          nameDiv.className = 'item-name';
          nameDiv.innerHTML = `<span contenteditable="true" id="${item.id}">${item.name}</span>`;
          
          if (item.badge) {
            const badge = document.createElement('span');
            badge.style.cssText = 'background:#e7d2c5;border-radius:60px;padding:0.2rem 1rem;margin-left:8px;font-size:0.7rem;font-weight:700;';
            badge.innerHTML = `
              <span contenteditable="true" id="${item.id}Badge">${item.badge}</span>
              <button class="delete-btn" style="width:24px;height:24px;margin-left:6px;" onclick="deleteBadge('${item.id}')">
                <i class="fas fa-times"></i>
              </button>
            `;
            nameDiv.appendChild(badge);
          } else {
            const addBtn = document.createElement('button');
            addBtn.className = 'add-badge-btn';
            addBtn.style.cssText = 'background:#9f7e6b;color:white;border:none;border-radius:40px;padding:0.2rem 1rem;margin-left:8px;font-size:0.7rem;';
            addBtn.innerHTML = '<i class="fas fa-tag"></i> ADD BADGE';
            addBtn.onclick = (e) => { e.stopPropagation(); addBadgeToItem(item.id); };
            nameDiv.appendChild(addBtn);
          }
          
          const descDiv = document.createElement('div');
          descDiv.className = 'item-desc';
          descDiv.innerHTML = `<span contenteditable="true" id="${item.id}Desc">${item.desc}</span>`;
          
          left.appendChild(nameDiv);
          left.appendChild(descDiv);
          
          const right = document.createElement('div');
          right.style.display = 'flex';
          right.style.alignItems = 'center';
          right.style.gap = '8px';
          
          const price = document.createElement('span');
          price.className = 'price-tag';
          price.innerHTML = `<span contenteditable="true" id="${item.id}Price">${item.price}</span>`;
          
          const del = document.createElement('button');
          del.className = 'delete-btn';
          del.innerHTML = '<i class="fas fa-trash"></i>';
          del.onclick = () => deleteMenuItem(cat.id, item.id);
          
          right.appendChild(price);
          right.appendChild(del);
          
          row.appendChild(left);
          row.appendChild(right);
          card.appendChild(row);
        });
        
        const addBtn = document.createElement('button');
        addBtn.className = 'add-item-btn';
        addBtn.innerHTML = '<i class="fas fa-plus-circle"></i> ADD NEW ITEM';
        addBtn.onclick = () => addNewItem(cat.id);
        card.appendChild(addBtn);
        
        container.appendChild(card);
      });
      
      renderFooter();
      
      // Apply edit mode state
      const master = document.getElementById('masterMenu');
      if (!isEditMode) {
        master.classList.add('editing-disabled');
      } else {
        master.classList.remove('editing-disabled');
      }
    }

    function renderFooter() {
      const container = document.getElementById('footerBadgesContainer');
      if (!container) return;
      
      container.innerHTML = '';
      menuData.footer.forEach(f => {
        const badge = document.createElement('span');
        badge.className = 'footer-badge';
        badge.innerHTML = `
          <i class="fas fa-heart" style="color:#a5664a;"></i>
          <span contenteditable="true" id="${f.id}">${f.text}</span>
          <button class="delete-btn" style="width:24px;height:24px;" onclick="deleteFooterItem('${f.id}')">
            <i class="fas fa-times"></i>
          </button>
        `;
        container.appendChild(badge);
      });
    }

    // ---------- TOGGLE EDIT MODE ----------
    window.toggleEditMode = function() {
      isEditMode = !isEditMode;
      const btn = document.getElementById('editModeBtn');
      const master = document.getElementById('masterMenu');
      if (isEditMode) {
        btn.innerHTML = '<i class="fas fa-lock-open"></i> EDIT ON';
        btn.classList.add('active');
        master.classList.remove('editing-disabled');
      } else {
        btn.innerHTML = '<i class="fas fa-lock"></i> EDIT OFF';
        btn.classList.remove('active');
        master.classList.add('editing-disabled');
      }
    };

    // ---------- CRUD OPERATIONS ----------
    window.deleteCategory = function(id) {
      if (!isEditMode) return alert('Turn ON Edit Mode first');
      if (confirm('Delete this entire category?')) {
        menuData.categories = menuData.categories.filter(c => c.id !== id);
        renderOwnerMenu();
        saveToLocalStorage(false);
      }
    };
    
    window.deleteMenuItem = function(catId, itemId) {
      if (!isEditMode) return alert('Turn ON Edit Mode first');
      const cat = menuData.categories.find(c => c.id === catId);
      if (cat) {
        cat.items = cat.items.filter(i => i.id !== itemId);
        renderOwnerMenu();
        saveToLocalStorage(false);
      }
    };
    
    window.deleteBadge = function(itemId) {
      if (!isEditMode) return alert('Turn ON Edit Mode first');
      menuData.categories.forEach(c => c.items.forEach(i => { if (i.id === itemId) i.badge = null; }));
      renderOwnerMenu();
      saveToLocalStorage(false);
    };
    
    window.deleteFooterItem = function(id) {
      if (!isEditMode) return alert('Turn ON Edit Mode first');
      menuData.footer = menuData.footer.filter(f => f.id !== id);
      renderOwnerMenu();
      saveToLocalStorage(false);
    };
    
    window.addNewCategory = function() {
      if (!isEditMode) return alert('Turn ON Edit Mode first');
      const id = 'cat' + Date.now();
      menuData.categories.push({ 
        id, 
        title: 'New Category', 
        icon: 'utensils', 
        items: [{ 
          id: generateId(id+'_item'), 
          name: 'New Dish', 
          desc: 'description here', 
          price: '199', 
          badge: null 
        }] 
      });
      renderOwnerMenu();
      saveToLocalStorage(false);
    };
    
    window.addNewItem = function(catId) {
      if (!isEditMode) return alert('Turn ON Edit Mode first');
      const cat = menuData.categories.find(c => c.id === catId);
      if (cat) {
        cat.items.push({ 
          id: generateId(catId+'_item'), 
          name: 'New Item', 
          desc: 'item description', 
          price: '199', 
          badge: null 
        });
        renderOwnerMenu();
        saveToLocalStorage(false);
      }
    };
    
    window.addBadgeToItem = function(itemId) {
      if (!isEditMode) return alert('Turn ON Edit Mode first');
      const text = prompt('Enter badge text (e.g., vegan, spicy, signature):');
      if (text && text.trim()) {
        menuData.categories.forEach(c => c.items.forEach(i => { 
          if (i.id === itemId) i.badge = text.trim(); 
        }));
        renderOwnerMenu();
        saveToLocalStorage(false);
      }
    };
    
    window.addFooterItem = function() {
      if (!isEditMode) return alert('Turn ON Edit Mode first');
      menuData.footer.push({ id: 'footer'+Date.now(), text: 'new feature' });
      renderOwnerMenu();
      saveToLocalStorage(false);
    };

    // ========== ðŸš€ INITIALIZE - LOAD SAVED DATA AND RENDER ==========
    window.onload = function() {
      // 1. LOAD SAVED DATA FIRST!
      loadSavedData();
      
      // 2. RENDER MENU WITH SAVED DATA
      renderOwnerMenu();
      
      // 3. UPDATE DOM FIELDS WITH SAVED DATA
      updateDOMWithSavedData();
      
      // 4. SETUP EVENT LISTENERS
      document.getElementById('editModeBtn').addEventListener('click', toggleEditMode);
      document.getElementById('saveBtn').addEventListener('click', () => saveToLocalStorage(true));
      document.getElementById('addCategoryBtn').addEventListener('click', addNewCategory);
      document.getElementById('addFooterBtn').addEventListener('click', addFooterItem);
      
      // 5. AUTO-SAVE EVERY 30 SECONDS
      setInterval(() => {
        saveToLocalStorage(false);
      }, 30000);
      
      console.log('ðŸš€ Owner panel loaded with SAVED data');
    };
  </script>
</body>
</html>
