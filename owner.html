<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Niyalo · Owner Suite</title>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&family=Playfair+Display:ital,wght@0,400;0,500;0,600;0,700;1,600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      background: #12100e;
      background-image: radial-gradient(circle at 15% 30%, #2a2420 0%, #12100e 95%);
      font-family: 'Plus Jakarta Sans', sans-serif;
      padding: 2rem;
      display: flex;
      justify-content: center;
    }
    .owner-container {
      max-width: 1400px;
      width: 100%;
    }
    
    /* ----- PREMIUM HEADER ----- */
    .owner-header {
      background: rgba(28, 24, 22, 0.95);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(196, 154, 108, 0.3);
      border-radius: 100px 100px 30px 30px;
      padding: 1.2rem 2.5rem;
      margin-bottom: 2rem;
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
      border-bottom: 5px solid #c49a6c;
      box-shadow: 0 20px 40px -10px black;
    }
    .logo-area {
      display: flex;
      align-items: center;
      gap: 16px;
    }
    .logo-icon {
      background: #c49a6c;
      width: 54px;
      height: 54px;
      border-radius: 18px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.8rem;
      color: #12100e;
      box-shadow: 0 8px 15px rgba(196, 154, 108, 0.4);
    }
    .logo-text h1 {
      font-family: 'Playfair Display', serif;
      font-size: 2rem;
      font-weight: 700;
      color: #fcede5;
      letter-spacing: -0.5px;
    }
    .logo-text span {
      font-size: 0.75rem;
      color: #c9ad93;
      letter-spacing: 3px;
      text-transform: uppercase;
    }
    
    /* ----- EDIT MODE TOGGLE ----- */
    .edit-controls {
      display: flex;
      gap: 1rem;
      align-items: center;
    }
    .edit-mode-btn {
      background: #2d5a4b;
      color: white;
      border: 1px solid #6b9b87;
      padding: 0.8rem 2.2rem;
      border-radius: 60px;
      font-size: 1rem;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 12px;
      cursor: pointer;
      transition: all 0.2s;
    }
    .edit-mode-btn.active {
      background: #c49a6c;
      border-color: #e0b692;
      box-shadow: 0 0 15px #c49a6c;
    }
    .save-btn {
      background: #27ae60;
      color: white;
      border: none;
      padding: 0.8rem 2.5rem;
      border-radius: 60px;
      font-size: 1rem;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 12px;
      cursor: pointer;
      transition: 0.2s;
      box-shadow: 0 5px 15px rgba(39, 174, 96, 0.3);
    }
    .save-btn:hover {
      background: #2ecc71;
      transform: scale(1.05);
    }
    .guest-link {
      background: #5f4a3d;
      color: white;
      padding: 0.8rem 2rem;
      border-radius: 60px;
      text-decoration: none;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
      border: 1px solid #a8846a;
    }
    
    /* ----- EDITABLE STYLES - ONLY WHEN EDIT MODE ACTIVE ----- */
    [contenteditable="true"] {
      outline: none;
      border-bottom: 2px dashed #b18067;
      background: rgba(255, 235, 220, 0.3);
      cursor: text;
      min-width: 1.8rem;
      display: inline-block;
      padding: 0 6px;
      border-radius: 6px 6px 2px 2px;
      transition: all 0.15s;
      color: #2d241f;
    }
    [contenteditable="true"]:hover {
      background: #ffede1;
      border-bottom: 2px solid #b1522e;
    }
    [contenteditable="true"]:focus {
      background: #fff8e7;
      border-bottom: 4px solid #7e4f3a;
      box-shadow: 0 6px 12px rgba(126, 79, 58, 0.15);
    }
    
    /* ----- LOCKED MODE - COMPLETELY UNCLICKABLE, NO HOVER, NO CURSOR ----- */
    .editing-disabled [contenteditable="true"],
    .editing-disabled .category-title span,
    .editing-disabled .item-name span,
    .editing-disabled .item-desc span,
    .editing-disabled .price-tag span,
    .editing-disabled .footer-badge span,
    .editing-disabled #hotelName,
    .editing-disabled #hotelLocation,
    .editing-disabled #hotelTagline,
    .editing-disabled #hours,
    .editing-disabled #phone,
    .editing-disabled #address,
    .editing-disabled #heartNote {
      border-bottom: none !important;
      background: transparent !important;
      cursor: default !important;
      pointer-events: none !important;
      user-select: none !important;
      -webkit-user-select: none !important;
      color: #2d241f !important;
    }
    
    .editing-disabled .delete-btn,
    .editing-disabled .delete-cat-btn,
    .editing-disabled .add-item-btn,
    .editing-disabled .add-category-btn,
    .editing-disabled .add-badge-btn,
    .editing-disabled .add-footer-btn {
      opacity: 0 !important;
      pointer-events: none !important;
      visibility: hidden !important;
      display: none !important;
    }
    
    /* No hover effects when disabled */
    .editing-disabled .menu-row:hover {
      background: transparent !important;
    }
    
    .editing-disabled .category-card:hover {
      border-color: #efdbd1 !important;
      box-shadow: 0 15px 30px -15px rgba(79, 53, 41, 0.12) !important;
    }
    
    /* ----- MAIN MENU CARD ----- */
    .menu-master {
      background: #fcf7f2;
      border-radius: 64px 64px 48px 48px;
      padding: 2.8rem;
      box-shadow: 0 40px 60px -20px black;
      border: 1px solid rgba(229, 179, 144, 0.5);
      margin-bottom: 2rem;
    }
    
    /* ----- HOTEL HEADER ----- */
    .hotel-profile {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2.5rem;
      border-bottom: 3px dashed #d4b19b;
      padding-bottom: 1.8rem;
    }
    .hotel-title {
      font-family: 'Playfair Display', serif;
      font-size: 2.8rem;
      font-weight: 700;
      color: #2b1e19;
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .hotel-title i {
      color: #a57159;
    }
    .contact-bubble {
      background: #fff1e9;
      padding: 0.8rem 2rem;
      border-radius: 80px;
      display: flex;
      flex-wrap: wrap;
      gap: 2rem;
    }
    
    /* ----- CATEGORY CARDS ----- */
    .category-card {
      background: white;
      border-radius: 44px;
      padding: 2rem;
      margin-bottom: 2.2rem;
      border: 1px solid #efdbd1;
      box-shadow: 0 15px 30px -15px rgba(79, 53, 41, 0.1);
      transition: all 0.2s;
    }
    .category-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 2px dotted #eacbbe;
      padding-bottom: 1rem;
      margin-bottom: 1.2rem;
    }
    .category-title {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .category-title i {
      font-size: 2rem;
      color: #aa7862;
    }
    .category-title h3 {
      font-family: 'Playfair Display', serif;
      font-size: 1.8rem;
      font-weight: 600;
      color: #3d2c24;
    }
    
    /* ----- MENU ROWS ----- */
    .menu-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.8rem 0;
      border-bottom: 1px dashed #efd9d0;
      transition: background 0.15s;
    }
    .item-name {
      font-weight: 700;
      font-size: 1.2rem;
      color: #2c1e19;
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
    }
    .item-desc {
      font-size: 0.85rem;
      color: #6b5246;
      margin-top: 2px;
    }
    .price-tag {
      font-weight: 800;
      font-size: 1.3rem;
      background: #ffefe7;
      padding: 0.2rem 1.2rem;
      border-radius: 60px;
      border: 1px solid #f3d9ce;
      color: #5c3d33;
    }
    .price-tag span:before {
      content: "रू";
      margin-right: 4px;
    }
    
    /* ----- BUTTONS ----- */
    .delete-btn, .delete-cat-btn {
      background: #c0392b;
      color: white;
      border: none;
      border-radius: 50%;
      width: 32px;
      height: 32px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      margin-left: 10px;
      transition: 0.2s;
    }
    .delete-cat-btn {
      border-radius: 40px;
      width: auto;
      padding: 0.3rem 1.2rem;
      gap: 6px;
    }
    .add-item-btn, .add-category-btn, .add-badge-btn, .add-footer-btn {
      background: #2c5f4b;
      color: white;
      border: none;
      border-radius: 60px;
      padding: 0.5rem 1.5rem;
      font-size: 0.9rem;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      margin-top: 0.8rem;
      transition: 0.2s;
    }
    .add-category-btn {
      background: #8e6b4f;
      padding: 0.8rem 2rem;
      font-size: 1rem;
    }
    .add-footer-btn {
      background: #8f6e5a;
    }
    
    /* ----- FOOTER ----- */
    .footer-editor {
      background: #fdf1ea;
      border-radius: 80px;
      padding: 2rem;
      margin-top: 2rem;
    }
    .footer-badge-container {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 1.5rem;
      margin-bottom: 1rem;
    }
    .footer-badge {
      background: #e7d2c5;
      border-radius: 60px;
      padding: 0.4rem 1.2rem;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }
    
    /* ----- SYNC STATUS ----- */
    .sync-status {
      display: flex;
      justify-content: flex-end;
      margin-top: 1rem;
    }
    .sync-pulse {
      background: #2d5a4b;
      color: white;
      padding: 0.7rem 2rem;
      border-radius: 60px;
      display: inline-flex;
      align-items: center;
      gap: 12px;
    }
    
    /* ----- NO SELECT, NO HOVER WHEN LOCKED ----- */
    .editing-disabled * {
      user-select: none !important;
      -webkit-user-select: none !important;
    }
  </style>
</head>
<body>
  <div class="owner-container">
    <!-- ========== OWNER HEADER ========== -->
    <div class="owner-header">
      <div class="logo-area">
        <div class="logo-icon">
          <i class="fas fa-crown"></i>
        </div>
        <div class="logo-text">
          <h1>Niyalo · Owner Suite</h1>
          <span><i class="fas fa-shield-alt"></i> RESTAURANT CONTROL</span>
        </div>
      </div>
      <div class="edit-controls">
        <!-- EDIT MODE TOGGLE BUTTON -->
        <button id="editModeBtn" class="edit-mode-btn active">
          <i class="fas fa-lock-open"></i> EDIT MODE ON
        </button>
        <!-- SAVE BUTTON -->
        <button id="saveBtn" class="save-btn">
          <i class="fas fa-cloud-upload-alt"></i> SAVE & PUBLISH
        </button>
        <!-- GUEST PREVIEW LINK -->
        <a href="index.html" target="_blank" class="guest-link">
          <i class="fas fa-eye"></i> GUEST VIEW
        </a>
      </div>
    </div>

    <!-- ========== MAIN EDITABLE MENU ========== -->
    <div class="menu-master" id="masterMenu">
      <!-- HOTEL INFO (EDITABLE) -->
      <div class="hotel-profile">
        <div>
          <div class="hotel-title">
            <i class="fas fa-leaf"></i>
            <span contenteditable="true" id="hotelName" spellcheck="false">Niyalo Cafe</span>
            <i class="fas fa-mug-hot"></i>
          </div>
          <div style="display: flex; gap: 12px; color: #5f4a3d; margin-top: 6px; margin-left: 0.5rem;">
            <i class="fas fa-map-pin"></i>
            <span contenteditable="true" id="hotelLocation" spellcheck="false">Lakeside, Pokhara</span>
            <span style="margin:0 6px;">•</span>
            <i class="fas fa-seedling"></i>
            <span contenteditable="true" id="hotelTagline" spellcheck="false">homemade · local love</span>
          </div>
        </div>
        <div class="contact-bubble">
          <span><i class="fas fa-clock"></i> <span contenteditable="true" id="hours" spellcheck="false">7:00 – 22:00 daily</span></span>
          <span><i class="fas fa-phone-alt"></i> <span contenteditable="true" id="phone" spellcheck="false">+977 981-234567</span></span>
          <span><i class="fas fa-location-dot"></i> <span contenteditable="true" id="address" spellcheck="false">Lakeside Rd, Pokhara</span></span>
        </div>
      </div>

      <!-- CATEGORIES CONTAINER (DYNAMIC) -->
      <div id="categoriesContainer"></div>

      <!-- ADD NEW CATEGORY BUTTON -->
      <div style="text-align: center;">
        <button class="add-category-btn" id="addCategoryBtn">
          <i class="fas fa-plus-circle"></i> ADD NEW CATEGORY
        </button>
      </div>

      <!-- FOOTER EDITOR SECTION -->
      <div class="footer-editor">
        <div style="text-align: center; margin-bottom: 1.2rem;">
          <span style="background: #ab8c7a; color: white; padding: 0.3rem 2rem; border-radius: 60px; font-weight: 600;">
            <i class="fas fa-heart"></i> FOOTER BADGES
          </span>
        </div>
        <div class="footer-badge-container" id="footerBadgesContainer"></div>
        <div style="text-align: center; margin-top: 1rem;">
          <button class="add-footer-btn" id="addFooterBtn">
            <i class="fas fa-plus"></i> ADD FOOTER BADGE
          </button>
        </div>
        <div style="text-align: center; margin-top: 1.8rem;">
          <i class="fas fa-heart" style="color: #c2714b;"></i>
          <span contenteditable="true" id="heartNote" spellcheck="false" style="font-size: 1.1rem;">order at counter · everything made to share</span>
          <i class="fas fa-heart" style="color: #c2714b;"></i>
        </div>
      </div>
    </div>

    <!-- SYNC STATUS -->
    <div class="sync-status">
      <div class="sync-pulse" id="syncStatus">
        <i class="fas fa-check-circle"></i> READY · EDIT MODE ACTIVE
      </div>
    </div>
  </div>

  <script>
    // ===========================================
    // NIYALO · OWNER PANEL - COMPLETELY LOCKED WHEN EDIT MODE OFF
    // NO CLICKING, NO SELECTING, NO HOVER, NOTHING
    // ===========================================
    
    // ---------- MASTER MENU DATA ----------
    let menuData = {
      hotel: {
        name: "Niyalo Cafe",
        location: "Lakeside, Pokhara",
        tagline: "homemade · local love",
        hours: "7:00 – 22:00 daily",
        phone: "+977 981-234567",
        address: "Lakeside Rd, Pokhara",
        heartNote: "order at counter · everything made to share"
      },
      footer: [
        { id: "footer1", text: "house-baked daily" },
        { id: "footer2", text: "vegan & gluten-free" },
        { id: "footer3", text: "free high-speed wifi" }
      ],
      categories: [
        {
          id: "cat1",
          title: "all-day breakfast",
          icon: "sunrise",
          items: [
            { id: "item1_1", name: "Niyalo Shakshuka", desc: "poached eggs · spiced tomato · feta", price: "590", badge: null },
            { id: "item1_2", name: "Cardamom French Toast", desc: "brioche · orange · maple", price: "520", badge: null },
            { id: "item1_3", name: "Avocado Garden Toast", desc: "sourdough · za'atar · radish", price: "580", badge: "vegan" },
            { id: "item1_4", name: "House Granola Pot", desc: "yoghurt · berries · honey", price: "420", badge: null }
          ]
        },
        {
          id: "cat2",
          title: "small plates",
          icon: "utensils",
          items: [
            { id: "item2_1", name: "Burnt Eggplant Dip", desc: "smoked paprika · flatbread", price: "450", badge: null },
            { id: "item2_2", name: "Chili Garlic Prawns", desc: "lemon · parsley · sourdough", price: "690", badge: null },
            { id: "item2_3", name: "Wild Mushroom Toast", desc: "thyme · truffle oil · pecorino", price: "620", badge: "signature" },
            { id: "item2_4", name: "Harissa Cauliflower", desc: "tahini · pomegranate · almonds", price: "510", badge: null }
          ]
        },
        {
          id: "cat3",
          title: "bowls & greens",
          icon: "leaf",
          items: [
            { id: "item3_1", name: "Niyalo Harvest Bowl", desc: "quinoa · sweet potato · kale · miso", price: "650", badge: null },
            { id: "item3_2", name: "Sesame Salmon", desc: "soba · edamame · pickled ginger", price: "820", badge: null },
            { id: "item3_3", name: "Turmeric Coconut Lentils", desc: "brown rice · crispy shallots", price: "550", badge: "vegan" }
          ]
        },
        {
          id: "cat4",
          title: "slow sips",
          icon: "mug-saucer",
          items: [
            { id: "item4_1", name: "House Espresso Blend", desc: "single origin · honey process", price: "210", badge: null },
            { id: "item4_2", name: "Cardamom Rose Latte", desc: "oat milk · dried rose petals", price: "290", badge: "best seller" },
            { id: "item4_3", name: "Iced Turmeric Tonic", desc: "ginger · lemon · agave", price: "250", badge: null },
            { id: "item4_4", name: "Salted Honey Affogato", desc: "gelato · espresso · maldon", price: "360", badge: null }
          ]
        },
        {
          id: "cat5",
          title: "sweet corner",
          icon: "cake",
          items: [
            { id: "item5_1", name: "Miso Chocolate Chip Cookie", desc: "brown butter · sea salt", price: "180", badge: null },
            { id: "item5_2", name: "Pistachio & Orange Cake", desc: "labneh frosting · rose", price: "320", badge: null },
            { id: "item5_3", name: "Vegan Berry Crumble", desc: "oat topping · coconut cream", price: "340", badge: null },
            { id: "item5_4", name: "Chai-Spiced Bun", desc: "cream cheese drizzle", price: "220", badge: null }
          ]
        },
        {
          id: "cat6",
          title: "cold + curated",
          icon: "wine-bottle",
          items: [
            { id: "item6_1", name: "Kombucha (rotating)", desc: "ginger · lemongrass · local", price: "250", badge: null },
            { id: "item6_2", name: "Orange & Carrot", desc: "cold pressed · turmeric", price: "290", badge: null },
            { id: "item6_3", name: "Michelada", desc: "lime · tajin · agave", price: "390", badge: null },
            { id: "item6_4", name: "Hibiscus Spritz", desc: "sparkling · mint · lime", price: "350", badge: null }
          ]
        }
      ]
    };

    // ---------- GLOBAL EDIT MODE STATE ----------
    let isEditMode = true; // Start with edit mode ON by default
    
    // ---------- GENERATE UNIQUE ID ----------
    function generateId(prefix) {
      return prefix + '_' + Date.now() + '_' + Math.floor(Math.random() * 1000);
    }

    // ---------- TOGGLE EDIT MODE ----------
    function toggleEditMode() {
      isEditMode = !isEditMode;
      const editBtn = document.getElementById('editModeBtn');
      const masterMenu = document.getElementById('masterMenu');
      
      if (isEditMode) {
        editBtn.innerHTML = '<i class="fas fa-lock-open"></i> EDIT MODE ON';
        editBtn.classList.add('active');
        masterMenu.classList.remove('editing-disabled');
      } else {
        editBtn.innerHTML = '<i class="fas fa-lock"></i> EDIT MODE OFF';
        editBtn.classList.remove('active');
        masterMenu.classList.add('editing-disabled');
      }
    }

    // ---------- SAVE TO LOCALSTORAGE (PUBLISH TO GUEST) ----------
    function saveToLocalStorage(showNotification = true) {
      // Update hotel data from DOM
      menuData.hotel.name = document.getElementById('hotelName')?.innerText || menuData.hotel.name;
      menuData.hotel.location = document.getElementById('hotelLocation')?.innerText || menuData.hotel.location;
      menuData.hotel.tagline = document.getElementById('hotelTagline')?.innerText || menuData.hotel.tagline;
      menuData.hotel.hours = document.getElementById('hours')?.innerText || menuData.hotel.hours;
      menuData.hotel.phone = document.getElementById('phone')?.innerText || menuData.hotel.phone;
      menuData.hotel.address = document.getElementById('address')?.innerText || menuData.hotel.address;
      menuData.hotel.heartNote = document.getElementById('heartNote')?.innerText || menuData.hotel.heartNote;
      
      // Update footer from DOM
      menuData.footer.forEach((item, index) => {
        const el = document.getElementById(item.id);
        if (el) item.text = el.innerText;
      });
      
      // Update items from DOM
      menuData.categories.forEach(cat => {
        cat.items.forEach(item => {
          const nameEl = document.getElementById(item.id);
          if (nameEl) item.name = nameEl.innerText;
          const descEl = document.getElementById(item.id + 'Desc');
          if (descEl) item.desc = descEl.innerText;
          const priceEl = document.getElementById(item.id + 'Price');
          if (priceEl) item.price = priceEl.innerText;
          const badgeEl = document.getElementById(item.id + 'Badge');
          if (badgeEl && item.badge) item.badge = badgeEl.innerText;
        });
        const titleEl = document.getElementById(cat.id + 'Title');
        if (titleEl) cat.title = titleEl.innerText;
      });
      
      // Save to localStorage
      localStorage.setItem('niyalo_live_menu', JSON.stringify(menuData));
      
      // Update sync status
      const statusEl = document.getElementById('syncStatus');
      if (statusEl) {
        statusEl.innerHTML = '<i class="fas fa-check-circle"></i> SAVED · GUEST UPDATED ' + new Date().toLocaleTimeString();
        statusEl.style.background = '#27ae60';
        
        // Reset after 3 seconds
        setTimeout(() => {
          if (statusEl) {
            statusEl.style.background = '#2d5a4b';
            statusEl.innerHTML = '<i class="fas fa-check-circle"></i> READY · ALL CHANGES SAVED';
          }
        }, 3000);
      }
      
      if (showNotification) {
        alert('✅ Menu published! Guest page now shows your changes.');
      }
      
      console.log('✅ Saved to localStorage at', new Date().toLocaleTimeString());
    }

    // ---------- RENDER OWNER MENU ----------
    function renderOwnerMenu() {
      const container = document.getElementById('categoriesContainer');
      container.innerHTML = '';
      
      menuData.categories.forEach(cat => {
        const card = document.createElement('div');
        card.className = 'category-card';
        
        // Header
        const header = document.createElement('div');
        header.className = 'category-header';
        header.innerHTML = `
          <div class="category-title">
            <i class="fas fa-${cat.icon}"></i>
            <h3><span contenteditable="true" id="${cat.id}Title" spellcheck="false">${cat.title}</span></h3>
          </div>
          <button class="delete-cat-btn" onclick="deleteCategory('${cat.id}')">
            <i class="fas fa-trash-alt"></i> DELETE
          </button>
        `;
        card.appendChild(header);
        
        // Items
        cat.items.forEach(item => {
          const row = document.createElement('div');
          row.className = 'menu-row';
          
          const leftDiv = document.createElement('div');
          leftDiv.style.flex = '1';
          
          const nameDiv = document.createElement('div');
          nameDiv.className = 'item-name';
          nameDiv.innerHTML = `<span contenteditable="true" id="${item.id}" spellcheck="false">${item.name}</span>`;
          
          // Badge handling
          if (item.badge) {
            const badgeSpan = document.createElement('span');
            badgeSpan.style.background = '#e7d2c5';
            badgeSpan.style.borderRadius = '60px';
            badgeSpan.style.padding = '0.2rem 1rem';
            badgeSpan.style.marginLeft = '10px';
            badgeSpan.style.fontSize = '0.7rem';
            badgeSpan.style.fontWeight = '700';
            badgeSpan.innerHTML = `
              <span contenteditable="true" id="${item.id}Badge" spellcheck="false">${item.badge}</span>
              <button class="delete-btn" style="width:24px; height:24px; margin-left:6px;" onclick="deleteBadge('${item.id}')">
                <i class="fas fa-times"></i>
              </button>
            `;
            nameDiv.appendChild(badgeSpan);
          } else {
            const addBadge = document.createElement('button');
            addBadge.className = 'add-badge-btn';
            addBadge.style.background = '#9f7e6b';
            addBadge.style.color = 'white';
            addBadge.style.border = 'none';
            addBadge.style.borderRadius = '40px';
            addBadge.style.padding = '0.2rem 1rem';
            addBadge.style.marginLeft = '10px';
            addBadge.style.fontSize = '0.7rem';
            addBadge.innerHTML = '<i class="fas fa-tag"></i> ADD BADGE';
            addBadge.onclick = (e) => {
              e.stopPropagation();
              addBadgeToItem(item.id);
            };
            nameDiv.appendChild(addBadge);
          }
          
          const descDiv = document.createElement('div');
          descDiv.className = 'item-desc';
          descDiv.innerHTML = `<span contenteditable="true" id="${item.id}Desc" spellcheck="false">${item.desc}</span>`;
          
          leftDiv.appendChild(nameDiv);
          leftDiv.appendChild(descDiv);
          
          const rightDiv = document.createElement('div');
          rightDiv.style.display = 'flex';
          rightDiv.style.alignItems = 'center';
          rightDiv.style.gap = '12px';
          
          const priceSpan = document.createElement('span');
          priceSpan.className = 'price-tag';
          priceSpan.innerHTML = `<span contenteditable="true" id="${item.id}Price" spellcheck="false">${item.price}</span>`;
          
          const deleteBtn = document.createElement('button');
          deleteBtn.className = 'delete-btn';
          deleteBtn.innerHTML = '<i class="fas fa-trash"></i>';
          deleteBtn.onclick = () => deleteMenuItem(cat.id, item.id);
          
          rightDiv.appendChild(priceSpan);
          rightDiv.appendChild(deleteBtn);
          
          row.appendChild(leftDiv);
          row.appendChild(rightDiv);
          card.appendChild(row);
        });
        
        // Add item button
        const addBtn = document.createElement('button');
        addBtn.className = 'add-item-btn';
        addBtn.innerHTML = '<i class="fas fa-plus-circle"></i> ADD NEW ITEM';
        addBtn.onclick = () => addNewItem(cat.id);
        card.appendChild(addBtn);
        
        container.appendChild(card);
      });
      
      // Render footer
      renderFooterBadges();
      
      // Apply current edit mode state
      const masterMenu = document.getElementById('masterMenu');
      if (!isEditMode) {
        masterMenu.classList.add('editing-disabled');
      } else {
        masterMenu.classList.remove('editing-disabled');
      }
    }

    // ---------- RENDER FOOTER BADGES ----------
    function renderFooterBadges() {
      const container = document.getElementById('footerBadgesContainer');
      container.innerHTML = '';
      
      menuData.footer.forEach(item => {
        const badge = document.createElement('span');
        badge.className = 'footer-badge';
        badge.innerHTML = `
          <i class="fas fa-heart" style="color:#a5664a;"></i>
          <span contenteditable="true" id="${item.id}" spellcheck="false">${item.text}</span>
          <button class="delete-btn" style="width:24px; height:24px;" onclick="deleteFooterItem('${item.id}')">
            <i class="fas fa-times"></i>
          </button>
        `;
        container.appendChild(badge);
      });
    }

    // ---------- CRUD OPERATIONS ----------
    window.deleteCategory = function(catId) {
      if (!isEditMode) {
        alert('⚠️ Please turn ON Edit Mode to make changes.');
        return;
      }
      if (confirm('Delete this entire category?')) {
        menuData.categories = menuData.categories.filter(c => c.id !== catId);
        renderOwnerMenu();
      }
    };
    
    window.deleteMenuItem = function(catId, itemId) {
      if (!isEditMode) {
        alert('⚠️ Please turn ON Edit Mode to make changes.');
        return;
      }
      if (confirm('Delete this item?')) {
        const cat = menuData.categories.find(c => c.id === catId);
        if (cat) {
          cat.items = cat.items.filter(i => i.id !== itemId);
          renderOwnerMenu();
        }
      }
    };
    
    window.deleteBadge = function(itemId) {
      if (!isEditMode) {
        alert('⚠️ Please turn ON Edit Mode to make changes.');
        return;
      }
      menuData.categories.forEach(cat => {
        cat.items.forEach(item => {
          if (item.id === itemId) item.badge = null;
        });
      });
      renderOwnerMenu();
    };
    
    window.deleteFooterItem = function(footerId) {
      if (!isEditMode) {
        alert('⚠️ Please turn ON Edit Mode to make changes.');
        return;
      }
      menuData.footer = menuData.footer.filter(f => f.id !== footerId);
      renderOwnerMenu();
    };
    
    window.addNewCategory = function() {
      if (!isEditMode) {
        alert('⚠️ Please turn ON Edit Mode to make changes.');
        return;
      }
      const newId = 'cat' + Date.now();
      menuData.categories.push({
        id: newId,
        title: 'New Category',
        icon: 'utensils',
        items: [{ id: generateId(newId + '_item'), name: 'New Dish', desc: 'description here', price: '199', badge: null }]
      });
      renderOwnerMenu();
    };
    
    window.addNewItem = function(catId) {
      if (!isEditMode) {
        alert('⚠️ Please turn ON Edit Mode to make changes.');
        return;
      }
      const cat = menuData.categories.find(c => c.id === catId);
      if (cat) {
        cat.items.push({
          id: generateId(catId + '_item'),
          name: 'New Item',
          desc: 'item description',
          price: '199',
          badge: null
        });
        renderOwnerMenu();
      }
    };
    
    window.addBadgeToItem = function(itemId) {
      if (!isEditMode) {
        alert('⚠️ Please turn ON Edit Mode to make changes.');
        return;
      }
      const text = prompt('Enter badge text (e.g., vegan, spicy, signature):');
      if (text && text.trim()) {
        menuData.categories.forEach(cat => {
          cat.items.forEach(item => {
            if (item.id === itemId) item.badge = text.trim();
          });
        });
        renderOwnerMenu();
      }
    };
    
    window.addFooterItem = function() {
      if (!isEditMode) {
        alert('⚠️ Please turn ON Edit Mode to make changes.');
        return;
      }
      menuData.footer.push({ id: 'footer' + Date.now(), text: 'new feature' });
      renderOwnerMenu();
    };

    // ---------- INITIALIZE ----------
    window.onload = function() {
      // Initial render
      renderOwnerMenu();
      
      // Set up Edit Mode button
      const editBtn = document.getElementById('editModeBtn');
      editBtn.addEventListener('click', toggleEditMode);
      
      // Set up Save button
      const saveBtn = document.getElementById('saveBtn');
      saveBtn.addEventListener('click', function() {
        saveToLocalStorage(true);
      });
      
      // Set up Add Category button
      document.getElementById('addCategoryBtn').addEventListener('click', addNewCategory);
      
      // Set up Add Footer button
      document.getElementById('addFooterBtn').addEventListener('click', addFooterItem);
      
      // Initial save to localStorage (so guest has data)
      setTimeout(() => {
        saveToLocalStorage(false);
      }, 500);
      
      // Update status
      const statusEl = document.getElementById('syncStatus');
      if (statusEl) {
        statusEl.innerHTML = '<i class="fas fa-check-circle"></i> READY · EDIT MODE ACTIVE';
      }
    };
  </script>
</body>
</html>