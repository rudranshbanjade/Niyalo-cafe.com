<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Niyalo Cafe · Digital Menu</title>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&family=Playfair+Display:ital,wght@0,400;0,500;0,600;0,700;1,600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    /* YOUR EXACT GUEST STYLES */
    *{margin:0;padding:0;box-sizing:border-box;}
    body{background:#fcf3ec;font-family:'Plus Jakarta Sans',sans-serif;padding:1rem;display:flex;justify-content:center;}
    .container{max-width:1300px;width:100%;}
    .header{background:#dac1b3;border-radius:40px 40px 20px 20px;padding:0.8rem 1.2rem;margin-bottom:1.2rem;display:flex;justify-content:space-between;align-items:center;border-bottom:4px solid #b18067;}
    .qr-badge{background:#765b4e;color:white;padding:0.4rem 1.2rem;border-radius:40px;}
    .live-badge{background:#2d5a4b;color:white;padding:0.4rem 1.2rem;border-radius:40px;display:flex;align-items:center;gap:6px;}
    .menu-card{background:white;border-radius:36px;padding:1.5rem;}
    .hotel-section{display:flex;flex-wrap:wrap;justify-content:space-between;align-items:center;margin-bottom:1.5rem;border-bottom:2px dashed #dbb9a8;padding-bottom:1.2rem;}
    .hotel-name{font-family:'Playfair Display',serif;font-size:2rem;font-weight:700;color:#35271f;display:flex;align-items:center;gap:8px;}
    .hotel-name i{color:#b18067;}
    .hotel-tagline{display:flex;align-items:center;gap:8px;color:#6b5548;font-size:0.85rem;margin-top:4px;}
    .contact-info{background:#fff9f2;padding:0.6rem 1.2rem;border-radius:50px;display:flex;flex-wrap:wrap;gap:1rem;}
    .category{background:#fffcf7;border-radius:28px;padding:1.2rem;margin-bottom:1.2rem;border:1px solid #f0ddd2;}
    .category-title{display:flex;align-items:center;gap:8px;border-bottom:2px dotted #eacec2;padding-bottom:0.8rem;margin-bottom:0.8rem;}
    .category-title i{font-size:1.6rem;color:#aa7862;}
    .category-title h2{font-family:'Playfair Display',serif;font-size:1.4rem;font-weight:600;color:#3d2c24;}
    .item{display:flex;justify-content:space-between;align-items:baseline;padding:0.6rem 0;border-bottom:1px dashed #efd9cf;}
    .item-name{font-weight:700;font-size:1rem;display:flex;align-items:center;gap:6px;flex-wrap:wrap;}
    .item-desc{font-size:0.75rem;color:#6b5246;}
    .price{font-weight:800;font-size:1.1rem;background:#ffefe7;padding:0.15rem 1rem;border-radius:40px;color:#5c3d33;}
    .price:before{content:"रू";margin-right:3px;}
    .badge{background:#e7d2c5;border-radius:40px;padding:0.15rem 0.8rem;font-size:0.55rem;font-weight:700;color:#4d352c;}
    .footer{background:#fdf3ed;border-radius:40px;padding:1.2rem;margin-top:1.5rem;text-align:center;}
    .footer-badges{display:flex;flex-wrap:wrap;justify-content:center;gap:0.7rem;margin-bottom:0.8rem;}
    .footer-badge{background:#e7d2c5;border-radius:40px;padding:0.25rem 1rem;display:inline-flex;align-items:center;gap:6px;font-size:0.75rem;}
    .pulse{width:8px;height:8px;background:#b3f0d0;border-radius:50%;animation:pulse 1.5s infinite;}
    @keyframes pulse{0%{opacity:0.6}100%{opacity:1;transform:scale(1.2);}}
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <span class="qr-badge"><i class="fas fa-qrcode"></i> NIYALO CAFE</span>
      <span class="live-badge"><span class="pulse"></span> LIVE</span>
    </div>
    
    <div class="menu-card" id="menuContent">
      <div style="text-align:center;padding:2rem;">
        <i class="fas fa-spinner fa-spin"></i>
        <p>Loading menu...</p>
      </div>
    </div>
  </div>

  <script>
    // CREATE SUPABASE CLIENT - ONLY ONCE!
    const supabaseClient = window.supabase.createClient(
      'https://outxrzhbocyvopmivzzf.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im91dHhyemhib2N5dm9wbWl2enpmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEwNTU1NDgsImV4cCI6MjA4NjYzMTU0OH0.apOAqrdlz3WBo9Aht3xzHc-XBkInHSQVfHu3NRuCxNc'
    );

    async function loadMenu() {
      try {
        const { data, error } = await supabaseClient
          .from('menus')
          .select('*')
          .eq('id', 1)
          .single();

        if (error) {
          console.log('Error loading menu:', error);
          document.getElementById('menuContent').innerHTML = '<p>Error loading menu. Please try again.</p>';
          return;
        }

        if (data && data.data) {
          const menu = data.data;
          let html = `
            <div class="hotel-section">
              <div>
                <div class="hotel-name">
                  <i class="fas fa-leaf"></i> <span>${menu.hotel.name}</span> <i class="fas fa-mug-hot"></i>
                </div>
                <div class="hotel-tagline">
                  <i class="fas fa-map-pin"></i> ${menu.hotel.location}
                  <span style="margin:0 4px;">•</span>
                  <i class="fas fa-seedling"></i> ${menu.hotel.tagline}
                </div>
              </div>
              <div class="contact-info">
                <div><i class="fas fa-clock"></i> ${menu.hotel.hours}</div>
                <div><i class="fas fa-phone-alt"></i> ${menu.hotel.phone}</div>
              </div>
            </div>
          `;
          
          if (menu.categories && menu.categories.length > 0) {
            menu.categories.forEach(cat => {
              html += `<div class="category"><div class="category-title"><i class="fas fa-${cat.icon}"></i><h2>${cat.title}</h2></div>`;
              if (cat.items && cat.items.length > 0) {
                cat.items.forEach(item => {
                  html += `<div class="item"><div><div class="item-name">${item.name}${item.badge ? `<span class="badge">${item.badge}</span>` : ''}</div><div class="item-desc">${item.desc}</div></div><span class="price">${item.price}</span></div>`;
                });
              }
              html += `</div>`;
            });
          }
          
          if (menu.footer && menu.footer.length > 0) {
            html += `<div class="footer"><div class="footer-badges">`;
            menu.footer.forEach(f => {
              html += `<span class="footer-badge"><i class="fas fa-heart"></i> ${f.text}</span>`;
            });
            html += `</div><div><i class="fas fa-heart" style="color:#c2714b;"></i> ${menu.hotel.heartNote} <i class="fas fa-heart" style="color:#c2714b;"></i></div></div>`;
          }
          
          document.getElementById('menuContent').innerHTML = html;
        } else {
          document.getElementById('menuContent').innerHTML = '<p>No menu data found.</p>';
        }
      } catch (err) {
        console.error('Error:', err);
        document.getElementById('menuContent').innerHTML = '<p>Error loading menu. Please try again.</p>';
      }
    }

    // Load immediately and refresh every 2 seconds
    loadMenu();
    setInterval(loadMenu, 2000);
  </script>
</body>
</html>
