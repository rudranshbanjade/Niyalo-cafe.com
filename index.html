<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes, viewport-fit=cover">
  <title>Niyalo Cafe Â· Digital Menu</title>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&family=Playfair+Display:ital,wght@0,400;0,500;0,600;0,700;1,600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    /* ----- GLOBAL RESET ----- */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      background: #fcf3ec;
      background-image: radial-gradient(circle at 10% 20%, #fff3ea 0%, #faede5 100%);
      font-family: 'Plus Jakarta Sans', sans-serif;
      padding: 1rem;
      display: flex;
      justify-content: center;
      min-height: 100vh;
    }
    .container {
      max-width: 1300px;
      width: 100%;
    }
    
    /* ----- PREMIUM HEADER (MOBILE FIRST) ----- */
    .header {
      background: #dac1b3;
      background: linear-gradient(145deg, #ddc5b8, #cfb2a2);
      border-radius: 40px 40px 20px 20px;
      padding: 0.8rem 1.2rem;
      margin-bottom: 1.2rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-bottom: 4px solid #b18067;
      box-shadow: 0 10px 20px -8px rgba(79, 53, 41, 0.2);
    }
    .qr-badge {
      background: #765b4e;
      color: white;
      padding: 0.4rem 1.2rem;
      border-radius: 40px;
      font-weight: 700;
      font-size: 0.8rem;
      display: flex;
      align-items: center;
      gap: 6px;
      letter-spacing: 1px;
      border: 1px solid #b08d7a;
    }
    .live-badge {
      background: #2d5a4b;
      color: white;
      padding: 0.4rem 1.2rem;
      border-radius: 40px;
      font-size: 0.75rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 6px;
      border: 1px solid #6b9b87;
    }
    .pulse {
      width: 8px;
      height: 8px;
      background: #b3f0d0;
      border-radius: 50%;
      box-shadow: 0 0 10px #6fdcb4;
      animation: pulse 1.5s infinite;
    }
    @keyframes pulse {
      0% { opacity: 0.6; transform: scale(1); }
      100% { opacity: 1; transform: scale(1.2); }
    }
    
    /* ----- MAIN MENU CARD ----- */
    .menu-card {
      background: white;
      border-radius: 36px;
      padding: 1.5rem;
      box-shadow: 0 25px 40px -20px rgba(45, 30, 24, 0.25);
      border: 1px solid #f0ddd2;
    }
    
    /* ----- HOTEL SECTION ----- */
    .hotel-section {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
      border-bottom: 2px dashed #dbb9a8;
      padding-bottom: 1.2rem;
    }
    .hotel-name {
      font-family: 'Playfair Display', serif;
      font-size: 2rem;
      font-weight: 700;
      color: #35271f;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .hotel-name i {
      color: #b18067;
      font-size: 1.8rem;
    }
    .hotel-tagline {
      display: flex;
      align-items: center;
      gap: 8px;
      color: #6b5548;
      font-size: 0.85rem;
      flex-wrap: wrap;
      margin-top: 4px;
    }
    .contact-info {
      background: #fff9f2;
      padding: 0.6rem 1.2rem;
      border-radius: 50px;
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      font-size: 0.8rem;
      border: 1px solid #ecd3c4;
    }
    .contact-info i {
      color: #b18067;
      width: 18px;
    }
    
    /* ----- CATEGORY CARDS ----- */
    .category {
      background: #fffcf7;
      border-radius: 28px;
      padding: 1.2rem;
      margin-bottom: 1.2rem;
      border: 1px solid #f0ddd2;
      transition: all 0.2s;
    }
    .category-title {
      display: flex;
      align-items: center;
      gap: 8px;
      border-bottom: 2px dotted #eacec2;
      padding-bottom: 0.8rem;
      margin-bottom: 0.8rem;
    }
    .category-title i {
      font-size: 1.6rem;
      color: #aa7862;
    }
    .category-title h2 {
      font-family: 'Playfair Display', serif;
      font-size: 1.4rem;
      font-weight: 600;
      color: #3d2c24;
    }
    
    /* ----- MENU ITEMS ----- */
    .item {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      padding: 0.6rem 0;
      border-bottom: 1px dashed #efd9cf;
    }
    .item:last-child {
      border-bottom: none;
    }
    .item-name {
      font-weight: 700;
      font-size: 1rem;
      color: #2c1e19;
      display: flex;
      align-items: center;
      gap: 6px;
      flex-wrap: wrap;
    }
    .item-desc {
      font-size: 0.75rem;
      color: #6b5246;
      margin-top: 2px;
      line-height: 1.3;
    }
    .price {
      font-weight: 800;
      font-size: 1.1rem;
      background: #ffefe7;
      padding: 0.15rem 1rem;
      border-radius: 40px;
      color: #5c3d33;
      white-space: nowrap;
      margin-left: 0.5rem;
      border: 1px solid #f3d9ce;
    }
    .price:before {
      content: "à¤°à¥‚";
      margin-right: 3px;
      font-size: 0.9rem;
    }
    .badge {
      background: #e7d2c5;
      border-radius: 40px;
      padding: 0.15rem 0.8rem;
      font-size: 0.55rem;
      font-weight: 700;
      text-transform: uppercase;
      color: #4d352c;
      letter-spacing: 0.5px;
      border: 1px solid #cfaa99;
    }
    
    /* ----- FOOTER SECTION ----- */
    .footer {
      background: #fdf3ed;
      border-radius: 40px;
      padding: 1.2rem;
      margin-top: 1.5rem;
      text-align: center;
      border: 1px solid #efd9cf;
    }
    .footer-badges {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 0.7rem;
      margin-bottom: 0.8rem;
    }
    .footer-badge {
      background: #e7d2c5;
      border-radius: 40px;
      padding: 0.25rem 1rem;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 0.75rem;
      color: #4d352c;
      border: 1px solid #d4b1a0;
    }
    .footer-badge i {
      color: #a5664a;
    }
    
    /* ----- REFRESH HINT (MOBILE) ----- */
    .refresh-hint {
      display: flex;
      justify-content: center;
      align-items: center;
      margin-top: 1rem;
      font-size: 0.65rem;
      color: #8b6f63;
      gap: 6px;
    }
    
    /* ----- HIDDEN OWNER LINK ----- */
    .owner-link {
      position: fixed;
      bottom: 15px;
      right: 15px;
      opacity: 0.2;
      transition: opacity 0.3s;
      z-index: 999;
    }
    .owner-link:hover {
      opacity: 0.8;
    }
    .owner-link a {
      background: #2d241f;
      color: white;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      text-decoration: none;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    }
    
    /* ----- DESKTOP OPTIMIZATION ----- */
    @media (min-width: 768px) {
      body { padding: 2rem; }
      .menu-card { padding: 2.5rem; }
      .hotel-name { font-size: 2.8rem; }
      .category-title h2 { font-size: 1.8rem; }
      .item-name { font-size: 1.2rem; }
      .item-desc { font-size: 0.85rem; }
      .price { font-size: 1.3rem; }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- HEADER -->
    <div class="header">
      <span class="qr-badge">
        <i class="fas fa-qrcode"></i> NIYALO CAFE
      </span>
      <span class="live-badge">
        <span class="pulse"></span>
        <span>LIVE Â· FRESH</span>
      </span>
    </div>
    
    <!-- MENU CONTENT -->
    <div class="menu-card" id="menuContent">
      <div style="text-align:center;padding:2.5rem 1rem;">
        <i class="fas fa-spinner fa-spin" style="font-size:2.2rem;color:#b18067;"></i>
        <p style="margin-top:1rem;color:#5f4a3d;font-weight:500;">Loading menu...</p>
      </div>
    </div>
    
    <!-- FOOTER NOTE -->
    <div class="refresh-hint">
      <i class="fas fa-sync-alt"></i> auto-updates every second
      <i class="fas fa-mobile-alt" style="margin-left:6px;"></i>
    </div>
    
    <!-- OWNER LINK (hidden) -->
    <div class="owner-link">
      <a href="owner.html" title="Owner Login">
        <i class="fas fa-crown"></i>
      </a>
    </div>
  </div>

  <script>
    // ===========================================
    // NIYALO Â· GUEST MENU - ULTIMATE MOBILE FIX
    // WORKS ON EVERY DEVICE, EVERY BROWSER
    // ===========================================
    
    // ---------- DEFAULT MENU (ALWAYS SHOWS) ----------
    const DEFAULT_MENU = {
      hotel: {
        name: "Niyalo Cafe",
        location: "Lakeside, Pokhara",
        tagline: "homemade Â· local love",
        hours: "7:00 â€“ 22:00 daily",
        phone: "+977 981-234567",
        address: "Lakeside Rd, Pokhara",
        heartNote: "order at counter Â· everything made to share"
      },
      footer: ["house-baked daily", "vegan & gluten-free", "free high-speed wifi"],
      categories: [
        {
          title: "all-day breakfast",
          icon: "sunrise",
          items: [
            { name: "Niyalo Shakshuka", desc: "poached eggs Â· spiced tomato Â· feta", price: "590", badge: null },
            { name: "Cardamom French Toast", desc: "brioche Â· orange Â· maple", price: "520", badge: null },
            { name: "Avocado Garden Toast", desc: "sourdough Â· za'atar Â· radish", price: "580", badge: "vegan" },
            { name: "House Granola Pot", desc: "yoghurt Â· berries Â· honey", price: "420", badge: null }
          ]
        },
        {
          title: "small plates",
          icon: "utensils",
          items: [
            { name: "Burnt Eggplant Dip", desc: "smoked paprika Â· flatbread", price: "450", badge: null },
            { name: "Chili Garlic Prawns", desc: "lemon Â· parsley Â· sourdough", price: "690", badge: null },
            { name: "Wild Mushroom Toast", desc: "thyme Â· truffle oil Â· pecorino", price: "620", badge: "signature" },
            { name: "Harissa Cauliflower", desc: "tahini Â· pomegranate Â· almonds", price: "510", badge: null }
          ]
        },
        {
          title: "bowls & greens",
          icon: "leaf",
          items: [
            { name: "Niyalo Harvest Bowl", desc: "quinoa Â· sweet potato Â· kale Â· miso", price: "650", badge: null },
            { name: "Sesame Salmon", desc: "soba Â· edamame Â· pickled ginger", price: "820", badge: null },
            { name: "Turmeric Coconut Lentils", desc: "brown rice Â· crispy shallots", price: "550", badge: "vegan" }
          ]
        },
        {
          title: "slow sips",
          icon: "mug-saucer",
          items: [
            { name: "House Espresso Blend", desc: "single origin Â· honey process", price: "210", badge: null },
            { name: "Cardamom Rose Latte", desc: "oat milk Â· dried rose petals", price: "290", badge: "best seller" },
            { name: "Iced Turmeric Tonic", desc: "ginger Â· lemon Â· agave", price: "250", badge: null },
            { name: "Salted Honey Affogato", desc: "gelato Â· espresso Â· maldon", price: "360", badge: null }
          ]
        },
        {
          title: "sweet corner",
          icon: "cake",
          items: [
            { name: "Miso Chocolate Chip Cookie", desc: "brown butter Â· sea salt", price: "180", badge: null },
            { name: "Pistachio & Orange Cake", desc: "labneh frosting Â· rose", price: "320", badge: null },
            { name: "Vegan Berry Crumble", desc: "oat topping Â· coconut cream", price: "340", badge: null },
            { name: "Chai-Spiced Bun", desc: "cream cheese drizzle", price: "220", badge: null }
          ]
        },
        {
          title: "cold + curated",
          icon: "wine-bottle",
          items: [
            { name: "Kombucha (rotating)", desc: "ginger Â· lemongrass Â· local", price: "250", badge: null },
            { name: "Orange & Carrot", desc: "cold pressed Â· turmeric", price: "290", badge: null },
            { name: "Michelada", desc: "lime Â· tajin Â· agave", price: "390", badge: null },
            { name: "Hibiscus Spritz", desc: "sparkling Â· mint Â· lime", price: "350", badge: null }
          ]
        }
      ]
    };

    // ---------- RENDER MENU FUNCTION ----------
    function renderMenu(data) {
      try {
        let html = `
          <div class="hotel-section">
            <div>
              <div class="hotel-name">
                <i class="fas fa-leaf"></i>
                <span>${data.hotel.name}</span>
                <i class="fas fa-mug-hot"></i>
              </div>
              <div class="hotel-tagline">
                <i class="fas fa-map-pin"></i> ${data.hotel.location}
                <span style="margin:0 4px;">â€¢</span>
                <i class="fas fa-seedling"></i> ${data.hotel.tagline}
              </div>
            </div>
            <div class="contact-info">
              <div><i class="fas fa-clock"></i> ${data.hotel.hours}</div>
              <div><i class="fas fa-phone-alt"></i> ${data.hotel.phone}</div>
            </div>
          </div>
        `;
        
        data.categories.forEach(cat => {
          html += `<div class="category">`;
          html += `<div class="category-title"><i class="fas fa-${cat.icon}"></i><h2>${cat.title}</h2></div>`;
          
          cat.items.forEach(item => {
            html += `<div class="item">`;
            html += `<div style="flex:1">`;
            html += `<div class="item-name">`;
            html += `<span>${item.name}</span>`;
            if (item.badge) {
              html += `<span class="badge">${item.badge}</span>`;
            }
            html += `</div>`;
            html += `<div class="item-desc">${item.desc}</div>`;
            html += `</div>`;
            html += `<span class="price">${item.price}</span>`;
            html += `</div>`;
          });
          html += `</div>`;
        });
        
        html += `<div class="footer">`;
        html += `<div class="footer-badges">`;
        data.footer.forEach(text => {
          html += `<span class="footer-badge"><i class="fas fa-heart"></i> ${text}</span>`;
        });
        html += `</div>`;
        html += `<div style="margin-top:0.8rem; font-size:0.9rem; color:#4a352e;">`;
        html += `<i class="fas fa-heart" style="color:#c2714b;"></i> ${data.hotel.heartNote} <i class="fas fa-heart" style="color:#c2714b;"></i>`;
        html += `</div>`;
        html += `</div>`;
        
        document.getElementById('menuContent').innerHTML = html;
      } catch(e) {
        console.log('Render error:', e);
      }
    }

    // ---------- LOAD MENU FROM LOCALSTORAGE ----------
    function loadMenu() {
      try {
        const saved = localStorage.getItem('niyalo_live_menu');
        if (saved) {
          const ownerData = JSON.parse(saved);
          const menuData = {
            hotel: ownerData.hotel || DEFAULT_MENU.hotel,
            footer: ownerData.footer ? ownerData.footer.map(f => f.text) : DEFAULT_MENU.footer,
            categories: ownerData.categories || DEFAULT_MENU.categories
          };
          renderMenu(menuData);
        } else {
          renderMenu(DEFAULT_MENU);
        }
      } catch(e) {
        renderMenu(DEFAULT_MENU);
      }
    }

    // ===========================================
    // MOBILE SYNC FIX - AGGRESSIVE UPDATES
    // ===========================================
    
    // 1. Load immediately
    loadMenu();
    
    // 2. Check EVERY 500ms (works on all mobile browsers)
    setInterval(loadMenu, 500);
    
    // 3. Listen for storage events (desktop)
    window.addEventListener('storage', function(e) {
      if (e.key === 'niyalo_live_menu' || e.key === 'niyalo_last_update') {
        loadMenu();
      }
    });
    
    // 4. Reload when page becomes visible (mobile Safari fix)
    document.addEventListener('visibilitychange', function() {
      if (!document.hidden) {
        loadMenu();
      }
    });
    
    // 5. Force reload on page show (mobile back button fix)
    window.addEventListener('pageshow', function() {
      loadMenu();
    });
    
    // 6. Touch event fallback (mobile Chrome fix)
    document.addEventListener('touchstart', function() {
      // Gentle check, not aggressive
      setTimeout(loadMenu, 100);
    }, { passive: true });
    
    console.log('ðŸš€ Niyalo Guest Menu - Mobile Optimized');
  </script>
</body>
</html>
